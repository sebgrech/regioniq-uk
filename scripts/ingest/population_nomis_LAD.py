# scripts/ingest/population_nomis_LAD.py
import os
import urllib.request
from pathlib import Path

RAW_DIR = Path("data/raw")
RAW_DIR.mkdir(parents=True, exist_ok=True)

# NOMIS API: Local Authority Districts (as of April 2023),
# persons, selected age bands, value measure
URL = (
    "https://www.nomisweb.co.uk/api/v01/dataset/NM_31_1.data.csv"
    "?geography=1774190593...1774190597,1774190637,1774190646,"
    "1774190675...1774190678,1774190691,1774190598...1774190601,"
    "1774190638,1774190639,1774190652,1774190653,1774190656...1774190670,"
    "1774190734,1774190602...1774190606,1774190654,1774190671...1774190674,"
    "1774190686...1774190690,1774190607...1774190610,1774190650,1774190651,"
    "1774190726,1774190735,1774190736,1774190738,1774190611...1774190613,"
    "1774190640,1774190679...1774190685,1774190740,1774190743,1774190745,"
    "1774190621...1774190624,1774190644,1774190645,1774190725,1774190729,"
    "1774190732,1774190737,1774190741,1774190692...1774190724,"
    "1774190625...1774190636,1774190649,1774190728,1774190731,"
    "1774190733,1774190739,1774190742,1774190744,1774190614...1774190620,"
    "1774190641...1774190643,1774190647,1774190648,1774190655,1774190727,"
    "1774190730,1774190746...1774190810"
    "&sex=7"
    "&age=0,24,22,25,20,21"
    "&measures=20100"
)

OUT = RAW_DIR / "population_lad_nomis.csv"
urllib.request.urlretrieve(URL, OUT.as_posix())

print(f"✅ Downloaded NOMIS raw → {OUT}")
